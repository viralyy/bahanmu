<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Stream</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0b0b;
  color:#f1f1f1;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif
}
.page{max-width:480px;margin:auto;padding:16px}
.center{min-height:100vh;display:flex;flex-direction:column;justify-content:center;text-align:center}
.hidden{display:none}

video{
  width:100%;
  border-radius:14px;
  background:#000;
  margin:12px 0;
  opacity:0;
  transform:scale(.98);
  transition:.4s ease
}
video.ready{opacity:1;transform:scale(1)}

h2,h3{margin:8px 0;font-weight:600}
p{color:#aaa;font-size:14px}

.btn{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
  width:100%;
  padding:12px;
  margin-top:8px;
  background:linear-gradient(135deg,#ff0055,#ff3c7d);
  color:#fff;
  text-decoration:none;
  border-radius:14px;
  font-weight:600
}

.stats{
  display:flex;
  justify-content:space-between;
  font-size:12px;
  color:#aaa;
  margin:6px 0 10px
}

.progress{
  width:100%;
  height:6px;
  background:#222;
  border-radius:99px;
  overflow:hidden;
  margin-top:8px;
  display:none
}
.progress div{
  height:100%;
  width:0%;
  background:#ff3c7d;
  animation:load 2s forwards
}
@keyframes load{to{width:100%}}

.video-wrap{position:relative}
.watermark{
  position:absolute;
  bottom:14px;
  right:14px;
  opacity:.6;
  pointer-events:none
}

/* comments */
#cusdis_thread{margin-top:16px}
.comment-bar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  font-size:12px;
  color:#aaa;
  margin-top:12px
}
.comment-btn{
  background:#222;
  padding:6px 10px;
  border-radius:99px;
  cursor:pointer
}
.comment-btn.new{background:#ff0055;color:#fff}

.cusdis-poweredby{display:none!important}
</style>
</head>

<body>

<div class="page center" id="empty">
  <h2>Video tidak tersedia</h2>
  <p>Gunakan link stream yang valid</p>
</div>

<div class="page hidden" id="watch">

  <h3 id="title"></h3>

  <div class="stats">
    <div id="views">üëÅ 0 views</div>
    <div id="online">‚óè 0 online</div>
  </div>

  <div class="video-wrap">
    <video id="player" controls playsinline></video>
    <svg class="watermark" width="80" height="20" viewBox="0 0 120 30">
      <text x="0" y="20" fill="#fff" font-size="16">STREAM+</text>
    </svg>
  </div>

  <div id="downloads"></div>

  <div class="progress" id="fakeProgress"><div></div></div>

  <a href="#" class="btn" id="shareBtn">Share this page</a>

  <!-- COMMENT BAR -->
  <div class="comment-bar">
    <div id="commentCount">üí¨ 0 komentar</div>
    <div class="comment-btn" id="commentBtn">Lihat komentar</div>
  </div>

  <!-- COMMENTS -->
  <div id="cusdis_thread"
    data-host="https://cusdis.com"
    data-app-id="e3cf9f0a-935d-4c79-a04f-19d760d0e0fd">
  </div>

</div>

<script src="app.js"></script>

<script>
const vid = new URLSearchParams(location.search).get("v") || "global";

/* views */
let views = localStorage.getItem("views_"+vid);
views = views ? parseInt(views)+1 : 1;
localStorage.setItem("views_"+vid, views);
views && (document.getElementById("views").textContent = "üëÅ "+views+" views");

/* online */
setInterval(()=>{
  document.getElementById("online").textContent =
    "‚óè "+(Math.floor(Math.random()*30)+10)+" online";
},4000);

/* share */
shareBtn.onclick=e=>{
  e.preventDefault();
  navigator.clipboard.writeText(location.href);
  alert("Link disalin!");
};

/* fake progress download */
document.addEventListener("click",e=>{
  if(e.target.closest("#downloads a")){
    fakeProgress.style.display="block";
    setTimeout(()=>fakeProgress.style.display="none",2200);
  }
});

/* video ready */
player.addEventListener("loadeddata",()=>player.classList.add("ready"));

/* =====================
   CUSDIS INIT + COUNT
===================== */
const pageId = "video-"+vid;
let lastCount = 0;

function initCusdis(){
  if(!window.CUSDIS) return;
  window.CUSDIS.setTheme("dark");
  window.CUSDIS.reset({
    pageId,
    pageUrl:location.href,
    pageTitle:title.textContent
  });
  setTimeout(countComments,2500);
}

function countComments(){
  const iframe=document.querySelector("#cusdis_thread iframe");
  if(!iframe) return setTimeout(countComments,1500);
  try{
    const doc=iframe.contentDocument;
    const c=doc.querySelectorAll(".comment").length;
    commentCount.textContent="üí¨ "+c+" komentar";

    if(c>lastCount && lastCount>0){
      commentBtn.classList.add("new");
      commentBtn.textContent="Komentar baru!";
    }
    lastCount=c;
  }catch{
    setTimeout(countComments,1500);
  }
}

/* scroll to comment */
commentBtn.onclick=()=>{
  cusdis_thread.scrollIntoView({behavior:"smooth"});
  commentBtn.classList.remove("new");
  commentBtn.textContent="Lihat komentar";
};

window.addEventListener("load",()=>setTimeout(initCusdis,800));
</script>

<script async defer src="https://cusdis.com/js/cusdis.es.js"></script>

<iframe src="histats.html" style="display:none"></iframe>

<script>
(function(s){
  s.dataset.zone='10109877';
  s.src='https://al5sm.com/tag.min.js';
})([document.documentElement, document.body].filter(Boolean)
  .pop()
  .appendChild(document.createElement('script')));
</script>

</body>
</html>
