<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0b0b;
  color:#f1f1f1;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif
}
.page{
  max-width:480px;
  margin:auto;
  padding:16px
}
h2{margin-bottom:14px}
input,textarea{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  background:#161616;
  border:1px solid #222;
  color:#fff;
  border-radius:12px
}
textarea{resize:none}
button{
  width:100%;
  padding:12px;
  background:linear-gradient(135deg,#ff0055,#ff3c7d);
  color:#fff;
  border:none;
  border-radius:14px;
  font-weight:600;
  cursor:pointer
}
button.small{
  padding:8px;
  font-size:13px;
  margin-top:6px
}
.btn-gray{background:#333}
.small{
  font-size:12px;
  color:#aaa;
  margin-bottom:6px
}
.card{
  background:#111;
  padding:12px;
  border-radius:14px;
  margin-bottom:10px
}
.preview-btn{
  background:#ff0055;
  padding:10px;
  border-radius:10px;
  text-align:center;
  margin-top:6px;
  font-weight:600
}
.row{
  display:flex;
  gap:6px
}
.row button{flex:1}
</style>
</head>

<body>
<div class="page">
<h2>Admin Panel</h2>

<input id="id" placeholder="ID video (ep1)">
<input id="titleInput" placeholder="Judul video">
<input id="stream" placeholder="Link stream">

<input id="download1" placeholder="Judul tombol 1 | link">
<input id="download2" placeholder="Judul tombol 2 | link">

<button onclick="generate()">Generate</button>

<div class="small">Preview</div>
<div id="preview" class="card"></div>

<div class="small">JSON Output</div>
<textarea id="json" rows="8" readonly></textarea>
<button class="small btn-gray" onclick="copyText('json')">ðŸ“‹ Salin JSON</button>

<div class="small">Link Stream</div>
<textarea id="link" rows="2" readonly></textarea>
<button class="small btn-gray" onclick="copyText('link')">ðŸ“‹ Salin Link</button>

<h3 style="margin-top:20px">History</h3>
<div id="history"></div>
</div>

<script>
const $ = id => document.getElementById(id);
let editIndex = null;

function generate(){
  const id = $('id').value.trim();
  const title = $('titleInput').value.trim();
  const src = $('stream').value.trim();
  const d1 = $('download1').value.trim();
  const d2 = $('download2').value.trim();

  if(!id || !title || !src){
    alert('Lengkapi data!');
    return;
  }

  const downloads = [];
  if(d1) downloads.push(parseDL(d1));
  if(d2) downloads.push(parseDL(d2));
  if(!downloads.length) downloads.push({label:'Download',url:src});

  const data = {
    [id]:{ title, src, downloads }
  };

  $('json').value = JSON.stringify(data,null,2);
  $('link').value = location.origin + location.pathname.replace('admin.html','') + '?v=' + id;

  renderPreview(data[id]);

  let h = JSON.parse(localStorage.getItem('history')||'[]');
  if(editIndex !== null){
    h[editIndex] = data;
    editIndex = null;
  }else{
    h.unshift(data);
  }
  localStorage.setItem('history',JSON.stringify(h.slice(0,10)));
  renderHistory();
}

function parseDL(str){
  const [label,url] = str.split('|').map(v=>v.trim());
  return {label:label||'Download',url:url||''};
}

function renderPreview(video){
  $('preview').innerHTML =
    `<h4>${video.title}</h4>` +
    video.downloads.map(d=>`<div class="preview-btn">${d.label}</div>`).join('');
}

function copyText(id){
  const el = $(id);
  if(!el.value) return alert('Kosong bre ðŸ—¿');
  el.select();
  el.setSelectionRange(0,99999);
  navigator.clipboard.writeText(el.value);
  alert('Disalin âœ…');
}

// ================= HISTORY =================

function renderHistory(){
  const h = JSON.parse(localStorage.getItem('history')||'[]');
  $('history').innerHTML = '';

  h.forEach((item,i)=>{
    const key = Object.keys(item)[0];
    const v = item[key];

    $('history').innerHTML += `
      <div class="card">
        <b>${key}</b> â€” ${v.title}
        <div class="row">
          <button class="small" onclick='editHistory(${i})'>Edit</button>
          <button class="small" onclick='renderPreview(${JSON.stringify(v).replace(/"/g,"&quot;")})'>Preview</button>
          <button class="small btn-gray" onclick='removeHistory(${i})'>Hapus</button>
        </div>
      </div>
    `;
  });
}

function editHistory(i){
  const h = JSON.parse(localStorage.getItem('history'));
  const item = h[i];
  const key = Object.keys(item)[0];
  const v = item[key];

  $('id').value = key;
  $('titleInput').value = v.title;
  $('stream').value = v.src;
  $('download1').value = v.downloads[0] ? `${v.downloads[0].label} | ${v.downloads[0].url}` : '';
  $('download2').value = v.downloads[1] ? `${v.downloads[1].label} | ${v.downloads[1].url}` : '';

  renderPreview(v);
  editIndex = i;
}

function removeHistory(i){
  const h = JSON.parse(localStorage.getItem('history'));
  h.splice(i,1);
  localStorage.setItem('history',JSON.stringify(h));
  renderHistory();
}

renderHistory();
</script>
</body>
</html>
