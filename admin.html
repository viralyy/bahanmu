<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  background:#0b0b0b;
  color:#f1f1f1;
  font-family:system-ui,-apple-system,BlinkMacSystemFont,sans-serif
}
.page{
  max-width:480px;
  margin:auto;
  padding:16px
}
h2{margin-bottom:14px}
input,textarea{
  width:100%;
  padding:12px;
  margin-bottom:10px;
  background:#161616;
  border:1px solid #222;
  color:#fff;
  border-radius:12px
}
textarea{resize:none}
button{
  width:100%;
  padding:12px;
  background:linear-gradient(135deg,#ff0055,#ff3c7d);
  color:#fff;
  border:none;
  border-radius:14px;
  font-weight:600;
  cursor:pointer
}
button.small{
  padding:6px 10px;
  font-size:12px;
  margin-right:4px;
  width:auto
}
.btn-gray{background:#333}
.card{
  background:#121212;
  border-radius:12px;
  padding:10px;
  margin-bottom:10px
}
hr{border:none;border-top:1px solid #222;margin:16px 0}
.small{font-size:12px;color:#aaa}
.preview a{
  display:block;
  background:#222;
  padding:8px;
  border-radius:10px;
  margin-top:6px;
  color:#fff;
  text-decoration:none;
  text-align:center
}
.row{margin-top:8px}
</style>
</head>

<body>

<div class="page">
<h2>Admin Panel</h2>

<input id="id" placeholder="ID video (ep1)">
<input id="title" placeholder="Judul video">
<input id="src" placeholder="Link stream">

<input id="d1" placeholder="Label | link download 1">
<input id="d2" placeholder="Label | link download 2">

<button onclick="generate()">Generate</button>

<div class="small">JSON Output</div>
<textarea id="json" rows="8" readonly></textarea>

<div class="small">Link Stream</div>
<textarea id="link" rows="2" readonly></textarea>

<div class="preview" id="preview"></div>

<hr>
<h3>History</h3>
<div id="history"></div>
</div>

<script>
const $ = id => document.getElementById(id);
let editIndex = null;

function parseDL(v){
  const p = v.split('|');
  return {label:(p[0]||'Download').trim(),url:(p[1]||p[0]).trim()};
}

function generate(){
  const id = $('id').value.trim();
  const title = $('title').value.trim();
  const src = $('src').value.trim();
  if(!id||!title||!src){alert('Lengkapi data');return}

  const downloads=[];
  if($('d1').value) downloads.push(parseDL($('d1').value));
  if($('d2').value) downloads.push(parseDL($('d2').value));
  if(!downloads.length) downloads.push({label:'Download',url:src});

  const data={
    [id]:{title,src,downloads}
  };

  $('json').value=JSON.stringify(data,null,2);
  $('link').value=location.origin+location.pathname.replace('admin.html','')+'?v='+id;
  renderPreview(data[id]);

  let h=JSON.parse(localStorage.getItem('history')||'[]');
  if(editIndex!==null){
    h[editIndex]=data;
    editIndex=null;
  }else{
    h.unshift(data);
  }
  localStorage.setItem('history',JSON.stringify(h.slice(0,10)));
  renderHistory();
}

function renderPreview(v){
  $('preview').innerHTML=v.downloads.map(d=>
    `<a href="${d.url}" target="_blank">${d.label}</a>`
  ).join('');
}

function renderHistory(){
  const h=JSON.parse(localStorage.getItem('history')||'[]');
  $('history').innerHTML=h.map((o,i)=>{
    const k=Object.keys(o)[0],v=o[k];
    return `<div class="card">
      <b>${v.title}</b>
      <div class="row">
        <button class="small" onclick="editHistory(${i})">Edit</button>
        <button class="small" onclick="renderPreview(${JSON.stringify(v).replace(/"/g,'&quot;')})">Preview</button>
        <button class="small btn-gray" onclick="del(${i})">Hapus</button>
      </div>
    </div>`;
  }).join('');
}

function editHistory(i){
  const h=JSON.parse(localStorage.getItem('history'));
  const o=h[i]; const k=Object.keys(o)[0]; const v=o[k];
  $('id').value=k;
  $('title').value=v.title;
  $('src').value=v.src;
  $('d1').value=v.downloads[0]?`${v.downloads[0].label} | ${v.downloads[0].url}`:'';
  $('d2').value=v.downloads[1]?`${v.downloads[1].label} | ${v.downloads[1].url}`:'';
  renderPreview(v);
  editIndex=i;
}

function del(i){
  let h=JSON.parse(localStorage.getItem('history'));
  h.splice(i,1);
  localStorage.setItem('history',JSON.stringify(h));
  renderHistory();
}

renderHistory();
</script>

</body>
</html>
